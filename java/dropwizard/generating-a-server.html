<!DOCTYPE html><html><head><title>guardrail: Generating a Server - java - dropwizard - guardrail</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Twilio" /><meta name="description" content="Principled code generation from OpenAPI specifications" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="guardrail: Generating a Server - java - dropwizard - guardrail" /><meta name="title" property="og:title" content="guardrail: Generating a Server - java - dropwizard - guardrail" /><meta name="og:site_name" content="guardrail" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Principled code generation from OpenAPI specifications" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="guardrail: Generating a Server - java - dropwizard - guardrail" /><meta name="twitter:image" content="https://guardrail.dev//img/poster.png" /><meta name="twitter:description" content="Principled code generation from OpenAPI specifications" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@guardrail_code" /><meta name="twitter:creator" content="@twilio" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/vs.css" /><link rel="stylesheet" href="/css/pattern-style.css" /><script async="async">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-154175369-1' , 'auto');
ga('send', 'pageview');
      </script></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>guardrail</span></div></a></li> <li><a href="/" class="">Getting Started</a></li> <li><a href="/java/" class="">Java</a> <ul class="sub-section"> <li><a href="/java/dropwizard/" class="">Dropwizard</a></li> <li><a href="/java/spring-mvc/" class="">Spring-MVC</a></li></ul></li> <li><a href="/scala/" class="">Scala</a> <ul class="sub-section"> <li><a href="/scala/akka-http" class="">akka-http</a></li> <li><a href="/scala/akka-http-jackson" class="">akka-http-jackson</a></li> <li><a href="/scala/http4s" class="">http4s</a></li></ul></li> <li><a href="/scalajs/" class="">ScalaJS</a> <ul class="sub-section"> <li><a href="/scalajs/endpoints" class="">endpoints (client only)</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/twilio/guardrail" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/twilio/guardrail" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('guardrail Principled code generation from OpenAPI specifications');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('guardrail Principled code generation from OpenAPI specifications');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="twilio" data-github-repo="guardrail"><div class="content-wrapper"><section><h1 id="generating-a-server">Generating a Server</h1>

<h2 id="setup">Setup</h2>

<p>As we saw in <a href="installation">Installation</a>, guardrail is run as part of maven. It hooks into the <code class="highlighter-rouge">generate-sources</code> goal. This means our generated server and client is always up-to-date with the specfificaion file.</p>

<p>Lets take another look at the maven config for guardrail:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    &lt;plugin&gt;
        &lt;groupId&gt;com.twilio&lt;/groupId&gt;
        &lt;artifactId&gt;guardrail-maven-plugin_2.12&lt;/artifactId&gt;
        &lt;version&gt;0.57.2&lt;/version&gt;
        &lt;executions&gt;
                &lt;id&gt;generate-simple-server&lt;/id&gt;           &lt;!-- to identify this execution. there can be more than one. --&gt;
                &lt;goals&gt;
                    &lt;goal&gt;generate-sources&lt;/goal&gt;         &lt;!-- always hook to generate-sources goal --&gt;
                &lt;/goals&gt;
                &lt;configuration&gt;
                    &lt;language&gt;java&lt;/language&gt;             &lt;!-- source code language to generate --&gt;
                    &lt;framework&gt;dropwizard&lt;/framework&gt;     &lt;!-- framework code to generate --&gt;
                    &lt;kind&gt;server&lt;/kind&gt;                   &lt;!-- to generate server routes or a http client --&gt;
                    &lt;specPath&gt;simple-spec.yaml&lt;/specPath&gt; &lt;!-- the Swagger/OpenAPI file for input --&gt;
                    &lt;packageName&gt;MyPackage&lt;/packageName&gt;  &lt;!-- all generated code will be in this jvm package --&gt;
                &lt;/configuration&gt;
            &lt;/execution&gt;
        &lt;/executions&gt;
    &lt;/plugin&gt;
</code></pre></div></div>

<p>Once configured, you can manually invoke guardrail with <code class="highlighter-rouge">mvn generate-sources</code>.</p>

<h2 id="server-handlers-resources">Server Handlers, Resources</h2>

<p>guardrail-generated servers come in two parts: a <code class="highlighter-rouge">Resource</code> and a <code class="highlighter-rouge">Handler</code>. The <code class="highlighter-rouge">Resource</code> contains all the JAX-RS routing logic, accepting a <code class="highlighter-rouge">Handler</code> as a definion of the logic to perform for the routes. The <code class="highlighter-rouge">Handler</code> is generated as an interface. You will write the implementation of the <code class="highlighter-rouge">Handler</code> and pass it to the <code class="highlighter-rouge">Resource</code> in the bootstrapping of the Dropwizard service.</p>

<p>Consider the sample OpenAPI spec file we saw back in <a href="sample-api-specification">Sample API Specification</a>. That specified one path. When guardrail generates the server components for us, there will be a <code class="highlighter-rouge">UserHandler</code> with one method of the following signature:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">CompletionStage</span><span class="o">&lt;</span><span class="nc">GetUserResponse</span><span class="o">&gt;</span> <span class="nf">getUser</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">)</span>
</code></pre></div></div>

<p>Breaking this down, we can see that for us to implement this route, we will be given the <code class="highlighter-rouge">id</code> from the path parameter. Give the ID, we will will return a value of type <code class="highlighter-rouge">GetUserResponse</code> wrapped in a <code class="highlighter-rouge">CompletionStage</code>. The special type <code class="highlighter-rouge">GetUserResponse</code> is also generated for us by guardrail. It is our interface to the responses defined in the OpenAPI spec file. Also, guardrail has set us to return a <code class="highlighter-rouge">CompletionStage</code> allowing us to compute our result asynchronous.</p>

<p>A simple implementation would be:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleHandlerImpl</span> <span class="kd">implements</span> <span class="nc">UsersHandler</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">CompletionStage</span><span class="o">&lt;</span><span class="nc">GetUserResponse</span><span class="o">&gt;</span> <span class="nf">getUser</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">CompletableFuture</span><span class="o">.</span><span class="na">supplyAsync</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="nc">UserAddress</span> <span class="n">address</span> <span class="o">=</span> <span class="o">(</span><span class="k">new</span> <span class="nc">UserAddress</span><span class="o">.</span><span class="na">Builder</span><span class="o">())</span>
                    <span class="o">.</span><span class="na">withLine1</span><span class="o">(</span><span class="s">"375 Beale st"</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">withLine2</span><span class="o">(</span><span class="s">"San Francisco, CA"</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            <span class="nc">List</span><span class="o">&lt;</span><span class="nc">UserAddress</span><span class="o">&gt;</span> <span class="n">userAddressList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
            <span class="n">userAddressList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">address</span><span class="o">);</span>
            <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="k">new</span> <span class="nc">User</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="s">"Jane Doe"</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">withUserAddresses</span><span class="o">(</span><span class="n">userAddressList</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            <span class="k">return</span> <span class="nc">GetUserResponse</span><span class="o">.</span><span class="na">Ok</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now we can examine the generated <code class="highlighter-rouge">Resource</code>. The resource companion class is generated with all the needed JAX-RS routing and parameter validation. In our Dropwizard Application class, where all resources are registerd with jersey, we can create the Resource and pass it our handler.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="kd">final</span> <span class="n">demowizardConfiguration</span> <span class="n">configuration</span><span class="o">,</span>
                    <span class="kd">final</span> <span class="nc">Environment</span> <span class="n">environment</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">environment</span><span class="o">.</span><span class="na">jersey</span><span class="o">().</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="nc">UsersResource</span><span class="o">(</span><span class="k">new</span> <span class="nc">SimpleHandlerImpl</span><span class="o">()));</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>This illistrates that while guardrail has helped us with much of the setup related to Dropwizard, we are still in controll of all the configuration of the Dropwizard service. Only the HTTP edge layer has been automated for us.</p>

<h2 id="separation-of-business-logic">Separation of business logic</h2>

<p>Providing an implementating of a function with a well-defined set of inputs and outputs is natural for any developer. By reducing the scope of the interface a developer writes against, implementations are more clear and concise.</p>

<p>Furthermore, by providing business logic as an implementation of an abstract class, unit tests can test the routing layer and business logic independently, by design.</p>

<h2 id="api-structure-slip-is-impossible">API structure slip is impossible</h2>

<p>As parameters are explicitly provided as arguments to functions in <code class="highlighter-rouge">Handler</code>s, any alteration to parameters constitute a new function interface that must be implemented. As a result, if providing an implementation for an externally managed specification, the compiler informs when a previously written function is no longer sufficient.</p>

<p>By representing different response codes and structures as members of a sealed trait, it’s impossible to return a structure that violates the specification, even for less frequently used response codes.</p>

<p>Finally, describing an endpoint in your specification without providing an implementation for it is a compiler error. This prevents reduction of functionality due to refactors, human error, or miscommunication with other teams.</p>

<p><span style="float: left"><a href="sample-api-specification">Prev: Sample API specification</a></span>
<span style="float: right"><a href="generating-clients">Next: Generating clients</a></span></p>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/yaml.min.js"></script><script>
// For all code blocks, copy the language from the containing div
// to the inner code tag (where hljs expects it to be)
const langPrefix = 'language-';
document.querySelectorAll(`div[class^='${langPrefix}']`).forEach(function(div) {
  div.classList.forEach(function(cssClass) {
    if (cssClass.startsWith(langPrefix)) {
      const lang = cssClass.substring(langPrefix.length);
      div.querySelectorAll('pre code').forEach(function(code) {
        code.classList.add(lang);
      });
    }
  });
});

hljs.configure({languages:['scala','java','bash','yaml','scala']});
hljs.initHighlightingOnLoad();
      </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/js/main.js"></script></body></html>